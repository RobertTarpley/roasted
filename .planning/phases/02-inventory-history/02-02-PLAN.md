---
phase: 02-inventory-history
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/inventory/page.tsx
  - src/features/inventory/InventoryScreen.tsx
  - src/features/inventory/CoffeeForm.tsx
  - src/features/inventory/LotForm.tsx
  - src/features/inventory/AdjustmentForm.tsx
autonomous: true

must_haves:
  truths:
    - "User can create coffee records with process and optional origin."
    - "User can add lots with starting inventory in pounds."
    - "User can record inventory adjustments and see them in lot details."
  artifacts:
    - path: "src/features/inventory/InventoryScreen.tsx"
      provides: "Inventory list UI with coffees, lots, and adjustments"
    - path: "src/app/inventory/page.tsx"
      provides: "Inventory route"
  key_links:
    - from: "src/features/inventory/InventoryScreen.tsx"
      to: "src/data/coffees.ts"
      via: "liveQuery listCoffees"
      pattern: "liveQuery"
    - from: "src/features/inventory/AdjustmentForm.tsx"
      to: "src/data/adjustments.ts"
      via: "addAdjustment"
      pattern: "addAdjustment"
---

<objective>
Deliver the inventory management UI for coffees, lots, and adjustments.

Purpose: Provide user-facing flows to create lots, view inventory, and record adjustments.
Output: Inventory screen and forms connected to Dexie repositories.
</objective>

<execution_context>
@/Users/bobsmachine/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bobsmachine/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-inventory-history/02-CONTEXT.md
@src/features/roast-log/HistoryScreen.tsx
@src/features/roast-log/PreRoastForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build inventory screen with coffee and lot creation</name>
  <files>
    src/app/inventory/page.tsx
    src/features/inventory/InventoryScreen.tsx
    src/features/inventory/CoffeeForm.tsx
    src/features/inventory/LotForm.tsx
  </files>
  <action>
    Create `InventoryScreen` with the same visual language as the timer/history screens (rounded cards, tan palette). Use `liveQuery` to load coffees and lots, and render a list of coffees with nested lot cards showing current inventory in lbs (to 3 decimals). Add top navigation links to `/` and `/history`.
    Implement `CoffeeForm` to create a coffee with required name, optional origin, and process options exactly: Natural, Washed, Honey/Pulped Natural, Experimental, Other. Use the Zod schemas from `src/domain/inventory/validation.ts` for validation and show inline errors. On success, clear the form.
    Implement `LotForm` that requires selecting a coffee, a lot label, and starting inventory in pounds (number input with step 0.1). Validate with Zod, store inventory as pounds, and normalize display to 3 decimals. Place the lot form inside each coffee section so lots are created under a coffee record.
    Add `src/app/inventory/page.tsx` to render `InventoryScreen` as a client component.
  </action>
  <verify>
    - npm run lint
    - npm run dev, visit /inventory, and confirm coffee + lot creation works and appears immediately
  </verify>
  <done>Inventory screen lists coffees and lots; coffee and lot creation flow works with validation.</done>
</task>

<task type="auto">
  <name>Task 2: Add lot adjustments and adjustment history</name>
  <files>
    src/features/inventory/InventoryScreen.tsx
    src/features/inventory/AdjustmentForm.tsx
  </files>
  <action>
    Add `AdjustmentForm` to each lot card with fields for amount (lbs, allow +/-, step 0.1) and reason (purchase or correction). Use Zod validation and show errors inline.
    On submit, call `addAdjustment` so the adjustment is recorded and the lot inventory updates immediately in the UI via liveQuery. Display a short adjustments list in the lot detail area (most recent first) showing date/time, reason, and signed amount. If inventory drops below zero, display the number normally but style it with a subtle warning color (no alerts, no blocking).
  </action>
  <verify>
    - npm run lint
    - In /inventory, add a + adjustment and a - adjustment; confirm inventory updates and adjustments list shows both entries
  </verify>
  <done>Lots show live-updating inventory and a visible adjustment list with purchase/correction entries.</done>
</task>

</tasks>

<verification>
- `npm run lint`
- Inventory page lets users create coffees, lots, and adjustments with immediate updates.
</verification>

<success_criteria>
- Coffees and lots can be created with required fields and process options.
- Adjustments update lot inventory immediately and appear in lot detail.
- Inventory screen is reachable at `/inventory` with navigation back to timer/history.
</success_criteria>

<output>
After completion, create `.planning/phases/02-inventory-history/02-02-SUMMARY.md`
</output>
