---
phase: 01-roast-capture-logs
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/features/timer/timerStore.ts
  - src/features/timer/TimerScreen.tsx
  - src/features/timer/TimerControls.tsx
  - src/features/timer/MarkerList.tsx
  - src/app/page.tsx
  - src/shared/format/time.ts
autonomous: true
must_haves:
  truths:
    - "User can start a roast timer and see live elapsed time"
    - "User can mark First Crack and Drop and see phase durations appear"
    - "User can tap a marker to view elapsed time at that event"
  artifacts:
    - path: "src/features/timer/timerStore.ts"
      provides: "Timer state machine and event log actions"
    - path: "src/features/timer/TimerScreen.tsx"
      provides: "Full-screen timer UI"
    - path: "src/features/timer/MarkerList.tsx"
      provides: "Marker list UI with tap-to-focus"
  key_links:
    - from: "src/features/timer/TimerScreen.tsx"
      to: "src/features/timer/timerStore.ts"
      via: "Zustand hooks"
      pattern: "useTimerStore"
    - from: "src/features/timer/MarkerList.tsx"
      to: "src/features/timer/timerStore.ts"
      via: "marker actions"
      pattern: "mark.*|clear.*"
---

<objective>
Build the full-screen timer experience with live elapsed time and event markers.

Purpose: Deliver the core timing workflow with required controls and marker interactions.
Output: Timer store, UI layout, and marker list with focus behavior.
</objective>

<execution_context>
@/Users/bobsmachine/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bobsmachine/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-roast-capture-logs/01-CONTEXT.md
@.planning/phases/01-roast-capture-logs/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement timer store with event-log state machine</name>
  <files>src/features/timer/timerStore.ts</files>
  <action>
    Create a Zustand store that manages roast session state: isRunning, startAt, events, focusedEventId, and derived phase times. Implement actions: start (records START at current timestamp), markFirstCrack, markDrop, stop, deleteMarker (removes FIRST_CRACK or DROP and any later events), and focusMarker (sets focusedEventId). Enforce event ordering and single-use markers using the domain validation helpers; disable invalid transitions. Store timestamps as epoch ms and derive elapsed via Date.now() - startAt to avoid background throttling issues. Expose selectors for total, development, and cooling durations using domain derivation helpers.
  </action>
  <verify>npm run lint</verify>
  <done>Timer store records events in valid order and exposes derived phase durations.</done>
</task>

<task type="auto">
  <name>Task 2: Build timer screen UI with controls and marker list</name>
  <files>src/features/timer/TimerScreen.tsx, src/features/timer/TimerControls.tsx, src/features/timer/MarkerList.tsx, src/app/page.tsx, src/shared/format/time.ts</files>
  <action>
    Implement a full-screen timer layout with minimal chrome. Show total time plus placeholders for phase durations before they exist. Add a bottom-center sticky Start/Stop primary button and secondary First Crack/Drop buttons per the two-tier control decision. Render a compact marker list under the timer, newest on top, with tap-to-focus that temporarily displays the elapsed time at that marker (using focusedEventId and derived elapsed at event timestamp). Add an explicit delete control per marker that calls the store deleteMarker action; markers are not otherwise editable. Create a shared time formatter helper for elapsed milliseconds to mm:ss with zero padding (no locale dependency) and use it for timer/marker readouts. Wire the page route to render the timer screen.
  </action>
  <verify>npm run lint</verify>
  <done>Timer screen renders full-screen layout with required controls and marker interactions.</done>
</task>

</tasks>

<verification>
- `npm run lint`
</verification>

<success_criteria>
- Users can start/stop a timer and see live elapsed time.
- First Crack and Drop markers appear and drive phase durations.
- Marker taps display elapsed time at the marker event.
</success_criteria>

<output>
After completion, create `.planning/phases/01-roast-capture-logs/01-02-SUMMARY.md`
</output>
