---
phase: 01-roast-capture-logs
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - src/features/timer/timerStore.ts
  - src/features/roast-log/PreRoastForm.tsx
  - src/features/roast-log/PostRoastForm.tsx
  - src/features/roast-log/ReviewScreen.tsx
  - src/features/roast-log/HistoryScreen.tsx
  - src/app/page.tsx
  - src/app/history/page.tsx
  - src/data/roasts.ts
autonomous: true
must_haves:
  truths:
    - "User can stop a roast, enter roasted weight, and review a complete roast log"
    - "Saving a roast persists notes, roast level, weights, and yield %"
    - "User can discard a roast with confirmation and return to a reset timer"
    - "User can delete the most recent roast from history"
  artifacts:
    - path: "src/features/roast-log/ReviewScreen.tsx"
      provides: "Save or discard review flow"
    - path: "src/features/roast-log/HistoryScreen.tsx"
      provides: "History list with delete last roast action"
    - path: "src/app/history/page.tsx"
      provides: "History route"
  key_links:
    - from: "src/features/roast-log/ReviewScreen.tsx"
      to: "src/data/roasts.ts"
      via: "saveRoast call"
      pattern: "saveRoast"
    - from: "src/app/history/page.tsx"
      to: "src/features/roast-log/HistoryScreen.tsx"
      via: "route render"
      pattern: "HistoryScreen"
---

<objective>
Add the roast log capture, review, save, discard, and minimal history delete flow.

Purpose: Complete Phase 1 by persisting roast records and providing required save/undo behavior.
Output: Pre/post roast forms, review screen, persistence wiring, and history delete action.
</objective>

<execution_context>
@/Users/bobsmachine/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bobsmachine/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-roast-capture-logs/01-CONTEXT.md
@.planning/phases/01-roast-capture-logs/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement pre/post roast forms and review flow</name>
  <files>src/features/roast-log/PreRoastForm.tsx, src/features/roast-log/PostRoastForm.tsx, src/features/roast-log/ReviewScreen.tsx, src/features/timer/timerStore.ts, src/app/page.tsx</files>
  <action>
    Add a pre-roast form for green weight grams, required before starting the timer. On Stop, transition to a post-roast form that collects roasted weight grams and roast level (Light/Medium/Dark). Use Zod validation and show inline errors for missing or invalid weights. Add an optional free-text notes input on the review screen. After post-roast entry, show a review screen summarizing times, weights, yield %, and notes. Provide Save and Discard actions; Discard must require a second confirmation and reset session state back to initial timer-ready state. Keep the flow sequence: Stop ends cooling -> roasted weight + roast level -> review -> save/discard.
  </action>
  <verify>npm run lint</verify>
  <done>Pre/post forms and review flow enforce required fields and allow save/discard transitions.</done>
</task>

<task type="auto">
  <name>Task 2: Persist roasts and add minimal history delete action</name>
  <files>src/features/roast-log/HistoryScreen.tsx, src/app/history/page.tsx, src/data/roasts.ts, src/features/roast-log/ReviewScreen.tsx</files>
  <action>
    Wire the review Save action to the repository (saveRoast) and reset the timer store to initial state after save. Add a minimal History screen that lists recent roasts (latest first) with summary fields and a "Delete last roast" action; confirm deletion before calling deleteRoast on the latest entry. Add a route at /history and provide a simple navigation link from the timer screen to history (no filters, no comparisons). Keep history focused on the delete-last action.
  </action>
  <verify>npm run lint</verify>
  <done>Saved roasts appear in history and the latest roast can be deleted with confirmation.</done>
</task>

</tasks>

<verification>
- `npm run lint`
</verification>

  <success_criteria>
  - Roast logs save required fields and compute yield %.
  - Discard flow confirms and resets to timer start.
  - History page supports delete-last roast action.
  </success_criteria>

<output>
After completion, create `.planning/phases/01-roast-capture-logs/01-03-SUMMARY.md`
</output>
