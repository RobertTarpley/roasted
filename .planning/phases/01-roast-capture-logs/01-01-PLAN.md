---
phase: 01-roast-capture-logs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/data/db.ts
  - src/data/roasts.ts
  - src/domain/roast-session/types.ts
  - src/domain/roast-session/derive.ts
  - src/domain/roast-session/validation.ts
autonomous: true
must_haves:
  truths:
    - "Local database can store completed roast logs"
    - "Roast session events are represented and validated in a consistent order"
    - "Derived totals and yield % can be computed from the event log"
  artifacts:
    - path: "src/domain/roast-session/types.ts"
      provides: "RoastEvent/RoastSession types"
    - path: "src/domain/roast-session/derive.ts"
      provides: "Phase time and yield % derivation helpers"
    - path: "src/data/db.ts"
      provides: "Dexie database instance for roasts"
    - path: "src/data/roasts.ts"
      provides: "Repository functions for roast persistence"
  key_links:
    - from: "src/data/roasts.ts"
      to: "src/data/db.ts"
      via: "Dexie table access"
      pattern: "db\\.roasts"
    - from: "src/domain/roast-session/derive.ts"
      to: "src/domain/roast-session/types.ts"
      via: "type imports"
      pattern: "import.*RoastEvent"
    - from: "src/domain/roast-session/validation.ts"
      to: "zod"
      via: "schema definitions"
      pattern: "z\\.object"
---

<objective>
Initialize the app scaffold and core roast session domain model with local persistence.

Purpose: Provide a stable foundation for timer state, validation, and saving roasts.
Output: Next.js app shell, roast session types/derivations, and Dexie persistence layer.
</objective>

<execution_context>
@/Users/bobsmachine/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bobsmachine/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-roast-capture-logs/01-CONTEXT.md
@.planning/phases/01-roast-capture-logs/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js app and install phase dependencies</name>
  <files>package.json</files>
  <action>
    If the app is not initialized, run Next.js app scaffolding with TypeScript, App Router, Tailwind, and npm (no src pages router). Install the phase dependencies at the versions listed in 01-RESEARCH.md: next, react, react-dom, tailwindcss, dexie, zustand, zod, date-fns. Keep default configs unless they conflict with App Router.
  </action>
  <verify>npm run lint</verify>
  <done>Project boots with App Router and required dependencies installed.</done>
</task>

<task type="auto">
  <name>Task 2: Define roast session types, derivations, and validation</name>
  <files>src/domain/roast-session/types.ts, src/domain/roast-session/derive.ts, src/domain/roast-session/validation.ts</files>
  <action>
    Create a roast session domain model as an event log with ordered events: START, FIRST_CRACK, DROP, STOP. Export types for events, roast session state, and derived phase times. Implement derivation helpers that compute total, development, and cooling durations, and yield % from weights (guard division by zero). Add Zod schemas to validate roast level (Light/Medium/Dark), weights (> 0, roasted <= green), optional notes, and the event ordering state machine.
  </action>
  <verify>npm run lint</verify>
  <done>Domain types and helpers enforce valid event order and weight rules.</done>
</task>

<task type="auto">
  <name>Task 3: Add Dexie database and roast repository</name>
  <files>src/data/db.ts, src/data/roasts.ts</files>
  <action>
    Create a Dexie database named RoastTimer with a roasts table. Store completed roasts with fields: id (auto), startedAt, endedAt, roastLevel, greenWeightGrams, roastedWeightGrams, yieldPercent, notes, and events (event log array). Implement repository functions: saveRoast (inserts), getLatestRoast (sorted by startedAt desc), listRoasts (descending), and deleteRoast (by id). Export typed accessors and ensure repository uses the domain types without any. Keep Dexie schema version at 1.
  </action>
  <verify>npm run lint</verify>
  <done>Completed roast logs can be saved and retrieved via repository helpers.</done>
</task>

</tasks>

<verification>
- `npm run lint`
</verification>

<success_criteria>
- App scaffold exists with required dependencies installed.
- Roast session event log and derivations are implemented and validated.
- Dexie repository can store and fetch completed roast logs.
</success_criteria>

<output>
After completion, create `.planning/phases/01-roast-capture-logs/01-01-SUMMARY.md`
</output>
