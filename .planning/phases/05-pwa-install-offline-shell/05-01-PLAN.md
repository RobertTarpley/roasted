---
phase: 05-pwa-install-offline-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/manifest.ts
  - src/app/layout.tsx
  - src/app/PwaServiceWorker.tsx
  - src/app/offline/page.tsx
  - src/app/install/page.tsx
  - src/features/inventory/InventoryScreen.tsx
  - public/sw.js
  - public/icons/icon-192.png
  - public/icons/icon-512.png
  - public/icons/apple-touch-icon.png
autonomous: true

must_haves:
  truths:
    - "User can install the app on iPhone and desktop with the name 'Roasted', a full-name icon, and standalone launch"
    - "When offline, the app launches to a cached inventory shell"
    - "User can open iOS Add to Home Screen guidance from within the app"
  artifacts:
    - path: "src/app/manifest.ts"
      provides: "PWA manifest with name, icons, start_url /inventory"
      contains: "start_url: \"/inventory\""
    - path: "public/icons/icon-192.png"
      provides: "192x192 PWA icon with full 'Roasted' name"
    - path: "public/icons/icon-512.png"
      provides: "512x512 PWA icon with full 'Roasted' name"
    - path: "public/icons/apple-touch-icon.png"
      provides: "Apple touch icon for iOS install"
    - path: "public/sw.js"
      provides: "Service worker caching app shell and offline fallback"
      contains: "roasted-shell"
    - path: "src/app/offline/page.tsx"
      provides: "Offline shell screen"
    - path: "src/app/install/page.tsx"
      provides: "In-app iOS install guidance"
    - path: "src/app/PwaServiceWorker.tsx"
      provides: "Client-side service worker registration"
  key_links:
    - from: "src/app/manifest.ts"
      to: "/inventory"
      via: "start_url"
      pattern: "start_url:\\s*\"/inventory\""
    - from: "src/app/PwaServiceWorker.tsx"
      to: "/sw.js"
      via: "navigator.serviceWorker.register"
      pattern: "register\\(\"/sw\\.js\""
    - from: "public/sw.js"
      to: "/offline"
      via: "offline fallback"
      pattern: "/offline"
    - from: "src/features/inventory/InventoryScreen.tsx"
      to: "/install"
      via: "Link"
      pattern: "href=\"/install\""
---

<objective>
Enable installable PWA metadata, offline app-shell support, and iOS install guidance for the Roasted app.

Purpose: Meet PWA-01 through PWA-03 with a passive install experience that launches to inventory.
Output: Manifest + icons, service worker offline shell, and in-app iOS guidance entry point.
</objective>

<execution_context>
@/Users/bobsmachine/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bobsmachine/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-pwa-install-offline-shell/05-CONTEXT.md
@.planning/phases/05-pwa-install-offline-shell/05-RESEARCH.md
@src/app/layout.tsx
@src/features/inventory/InventoryScreen.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PWA manifest, metadata, and icon assets</name>
  <files>
    src/app/manifest.ts
    src/app/layout.tsx
    public/icons/icon-192.png
    public/icons/icon-512.png
    public/icons/apple-touch-icon.png
  </files>
  <action>
    Create `src/app/manifest.ts` using the Next.js metadata route with `name`/`short_name` "Roasted", `start_url` "/inventory", `display` "standalone", and `scope` "/". Include 192x192 and 512x512 PNG icons from `public/icons/` and set `theme_color` and `background_color` to the app palette (match existing tan background). Use the locked app name and ensure the manifest only references icon files that exist.

    Update `src/app/layout.tsx` metadata to use the app title "Roasted" and a concise description of the roast timer + inventory use. Add Apple web app metadata (`appleWebApp` capable/title) and link the Apple touch icon so iOS uses the same full-name icon. Do not add any install prompt UI or `beforeinstallprompt` handling (passive install only).

    Create icon assets in `public/icons/` with a simple, legible wordmark that shows the full name "Roasted" and matches the existing tan/coffee palette. Generate PNGs for 192 and 512, plus an Apple touch icon at 180x180. Use an automated generator (e.g., `npx @vscode/pwa-asset-generator`) from a single SVG source so the icon style is consistent across sizes; avoid adding permanent dependencies to `package.json`.
  </action>
  <verify>
    - `npm run lint`
    - Visit `/manifest.webmanifest` in dev; name is "Roasted", start_url is `/inventory`, and icons resolve.
  </verify>
  <done>
    - Manifest serves with name "Roasted", start_url `/inventory`, display `standalone`, and valid icon entries.
    - Apple touch icon is linked in the document head and uses the full-name icon.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement service worker offline shell + registration</name>
  <files>
    public/sw.js
    src/app/PwaServiceWorker.tsx
    src/app/layout.tsx
    src/app/offline/page.tsx
  </files>
  <action>
    Create `public/sw.js` with a versioned cache (e.g., `roasted-shell-v1`) that precaches `/inventory` and `/offline` on install. On fetch, respond to navigation requests with a cache-first strategy: serve cached `/inventory` when available, fall back to network, and finally to `/offline` when the fetch fails. Avoid caching non-GET or API writes.

    Add a small client component `src/app/PwaServiceWorker.tsx` that registers `/sw.js` on mount when `navigator.serviceWorker` is available. Mount the component in `src/app/layout.tsx` so it runs for all routes.

    Create `src/app/offline/page.tsx` as a lightweight offline shell that matches existing styling and explains the app is offline while keeping the inventory context visible (title + short guidance to reconnect). Keep copy short and neutral.
  </action>
  <verify>
    - `npm run lint`
    - In dev tools: application -> service workers shows `/sw.js` registered.
    - Simulate offline and load `/inventory`; the offline shell appears instead of a network error.
  </verify>
  <done>
    - Service worker registers and controls navigations.
    - Offline navigation renders the offline shell and does not crash.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add iOS Add to Home Screen guidance entry point</name>
  <files>
    src/app/install/page.tsx
    src/features/inventory/InventoryScreen.tsx
  </files>
  <action>
    Create `src/app/install/page.tsx` with clear, passive iOS Add to Home Screen instructions (Safari share icon → "Add to Home Screen" → confirm name "Roasted"). Include a short note that install prompts are browser-driven and no button is required. Keep styling consistent with the tan card aesthetic used in inventory/history screens.

    Add a navigation entry point in `src/features/inventory/InventoryScreen.tsx` (e.g., link labeled "Install") within the existing header nav so the guidance is discoverable without introducing any install CTA or prompt logic.
  </action>
  <verify>
    - `npm run lint`
    - Navigate to `/install` from the inventory header; guidance content renders and matches existing styles.
  </verify>
  <done>
    - iOS install guidance is reachable from within the app without any install prompt UI.
  </done>
</task>

</tasks>

<verification>
- Lighthouse (or browser PWA checklist) shows installability with correct name/icon.
- Offline navigation to `/inventory` shows the offline shell.
- Install guidance is reachable in-app and provides iOS steps.
</verification>

<success_criteria>
- PWA install shows "Roasted" with the full-name icon on iPhone and desktop.
- Offline mode loads a cached shell instead of a network error.
- iOS Add to Home Screen guidance is accessible from the inventory screen.
</success_criteria>

<output>
After completion, create `.planning/phases/05-pwa-install-offline-shell/05-01-SUMMARY.md`
</output>
